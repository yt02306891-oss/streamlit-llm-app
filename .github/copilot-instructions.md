## 概要

このリポジトリは小さな Python スクリプト群（主に単一ファイルの CLI /ユーティリティ）で構成されています。AI アシスタント向けには「すぐに編集・テストできる」ための実務的な注意点をまとめます。

## 重要なファイル / エントリポイント

- `library_manage.py` — 図書館管理のメイン CLI。モジュールレベルのグローバル変数（`books`, `members`, `borrow_records`）を直接操作する手続き型コードが主体。主な関数例：`add_book()`, `borrow_book()`, `return_book()`, `calculate_fines()`。データ永続化は無し。
- `main.py` — LangChain/OpenAI を使うスニペット。外部サービス（OpenAI）に依存。`retriever` 等が未定義の箇所があるため、実行前に環境と依存を確認すること。
- `main2.py` — デモ的な最小ループコード。
- `test.py` — 小さな純関数群（カテゴリ分け、BMI など）。このファイルはスクリプト実行で動作確認が可能。
- `env/` — 仮想環境がコミットされている（`env\Scripts\Activate.ps1` など）。開発時はこの venv を有効化して作業するか、ローカル環境で新しい venv を作る。

## 開発ワークフロー（PowerShell）

- 仮想環境を有効化（推奨）:

  ```powershell
  .\env\Scripts\Activate.ps1
  ```

- CLI/スクリプト実行例:

  - 図書館 CLI を走らせる: `python .\library_manage.py`
  - テスト用スクリプトを実行: `python .\test.py`
  - LangChain を使う `main.py` は OpenAI キー等の環境変数（例: `OPENAI_API_KEY`）を設定し、依存パッケージを揃えてから実行する。

## プロジェクト特有のパターン（発見事項）

- グローバル状態: `library_manage.py` はモジュールレベルのリストを直接変更する実装で、関数は副作用（print / mutate globals）を伴います。AI が変更を加える際はこの副作用を考慮する（テスト時は状態リセットやコピーを使う）。
- 入出力スタイル: 多くの関数は標準出力にメッセージを出す（戻り値ではなく）。自動テストを追加する場合は、まず小さなユーティリティ関数を返り値ベースで分離するか、既存関数の副作用を検証するテストを書く。
- 日付とロジック: `borrow_records` の日付や `calculate_fines()` の日付差分は文字列ベースで固定値が使われています。日付操作を改善するなら `datetime` を使うが、既存コードの挙動（固定文字列）を壊さないよう注意する。
- 未定義の依存: `main.py` は `retriever` が未定義で、そのまま実行すると例外になります。外部 API（OpenAI/ LangChain）を触る変更は依存解決とキー管理が必要。

## 変更・PR を作るときの具体的ルール

1. 小さな変更単位で出す。特に `library_manage.py` のようなグローバル状態を触る変更は段階的に。例: 「add_book の重複チェックを改善する」など単一責任で PR を作る。
2. CLI 表示スタイルは既存の日本語メッセージに合わせる（全体が日本語）。メッセージ文言を変えるときは既存のフォーマットに整合させる。
3. 外部 API を使う変更は README（または PR の説明）に必要な環境変数と最小インストール手順を明記する（例: `OPENAI_API_KEY`）。

## 例（具体的な参照）

- 既存の貸出チェック: `library_manage.py` の `borrow_book()` は会員の貸出数を数えて 5 冊の上限をチェックしています。変更する場合は `borrow_records` のフィルタロジックを直接更新してください。
- `calculate_fines()` は `today` / `due_date` を文字列で扱っています — 日付差を直す場合は `datetime.strptime()` と差分計算を導入してください。ただし日付形式を変える場合は出力のテストを追加すること。

## 実行前チェックリスト（AI が変更を提案する前に）

- 変更がグローバル変数に与える影響を特定する（テストで state をリセットできるか）。
- `main.py` のような外部依存があるファイルは、実行可能性を確保するために依存注記（requirements）と環境変数を PR に含める。

----
もしこの内容で足りない箇所や、特に追記してほしい連携（例：CI／テストフレームワーク導入方針、外部サービスのモック方法など）があれば教えてください。内容を更新します。
